use crate::engine::bitboard::Bitboard;

pub const ARRAY_SIZE_BISHOP: usize = 512;
pub const ARRAY_SIZE_ROOK: usize = 4096;
pub const MAX_ATTEMPTS: usize = 1_000_000_000;

pub fn calculate_magic_index(occupancy: Bitboard, magic_number: u64, bits_in_mask: u8) -> usize {
    (occupancy.to_repr().wrapping_mul(magic_number) >> (64 - bits_in_mask)) as usize
}

pub fn generate_magic_number_candidate() -> u64 {
    let mut rng = fastrand::Rng::new();

    let n1 = rng.u64(..);
    let n2 = rng.u64(..);
    let n3 = rng.u64(..);

    n1 & n2 & n3
}

pub struct MagicNumbers {
    pub bishop: [u64; 64],
    pub rook: [u64; 64],
}

pub const PRECOMPUTED_MAGIC_NUMBERS: MagicNumbers = MagicNumbers {
    bishop: [
        4938205856228577312,
        40550303074189312,
        9268690624805093632,
        1200668853832704,
        2331245973405728,
        590257433880821860,
        13862362232368792608,
        37719854912647712,
        864699933273901312,
        8830461182472,
        23650555444396096,
        50670121521332224,
        9512738282606231752,
        10089191299170705408,
        551971471360,
        9511602972779352096,
        4661964467863712,
        5206724463596535938,
        616993157607081992,
        11267797342503048,
        9803492136191524864,
        2306408231339172352,
        9570497118339648,
        954921454981386240,
        722834348539150848,
        4756931539085824132,
        9306301868015648,
        22588642899853824,
        2740603101001031682,
        594618095931297920,
        2252076872696864,
        1153062791853376514,
        1128374078669824,
        72310619369904128,
        18058413338787874,
        2306406509496369664,
        9234633252131311632,
        9011670315704448,
        9224018601500541058,
        72341276963383554,
        289431198608965632,
        571750476170260,
        4688810247979009026,
        146371669412284416,
        13835129592802706436,
        162147214222690432,
        653058234214826240,
        78822151427195272,
        2306027779015049248,
        288303047069794304,
        4510233405948066,
        74593076715454528,
        76561400662730752,
        11329986321481728,
        4538832523919376,
        72774511128281088,
        9589974844442624,
        9272911781138014224,
        9372009589346963466,
        1157433902516937728,
        4611826758635897856,
        9835861621074296966,
        5224185223927300610,
        4591562713760257,
    ],
    rook: [
        2341871893205755008,
        18014673655832576,
        72075465397641216,
        324276765432219648,
        72060892707030032,
        7854286692272833536,
        36029346791555584,
        4755801348438508930,
        9232519974138939524,
        9223653651703152640,
        307089475006173440,
        9232942255857074208,
        281492425539840,
        13844628273344151556,
        4900479361733919232,
        303148568180031744,
        141287248363553,
        517914232027611200,
        4922434530289132544,
        290483279773040672,
        15133221197761741952,
        1733894657003229248,
        4807065395533826,
        145243287022747796,
        4634240856646303744,
        1170936493678534658,
        4503704856166528,
        1163063419189854336,
        2814895796258832,
        578782955239900176,
        565151132549376,
        2377900886719497249,
        144256200450506784,
        2342294293600804864,
        9227893230824071170,
        11399805284648960,
        2882444791105193984,
        9223935056098117764,
        9314007546324844808,
        9224515806543479060,
        58584453437620232,
        72655729706221570,
        141012936818705,
        144401305106972704,
        4512395787534464,
        4758057404397027456,
        79724273729552,
        9019844729372676,
        4775786069437202688,
        20302501538431232,
        289084284370764032,
        1298180185329240832,
        10376856629122697728,
        36593948143386752,
        1229484901859329024,
        18297042860278272,
        144260599059059970,
        2306076930348482689,
        144431848549910785,
        577622940457107465,
        1225542463130765314,
        36310289175676929,
        577023736683725058,
        1152925903735554082,
    ],
};
